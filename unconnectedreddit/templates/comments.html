{% extends "base.html" %}
{% load humanize %}
{% load emoticons_tags %}
{% load thumbnail %}
{% block content %}
<div class="margin">
{% if authorized %}

    {% if from_photos %}
        {% if from_photos == '1' and photostream_pk %}
        <a href="{% url 'see_photo_pk' photostream_pk %}">
        {% elif from_photos == '2' and photostream_pk  %}
        <a href="{% url 'see_best_photo_pk' photostream_pk %}">
        {% elif from_photos == '3' and photostream_pk  %}
        <a href="{% url 'user_profile_photo' username photo.id %}">
        {% elif from_photos == '4' and photostream_pk  %}
        <a href="{% url 'unseen_activity' username %}#section0">
        {% else %}
        <a href="{% url 'home' %}#section0">
        {% endif %}
    {% else %}
    <a href="{% url 'home' %}#section0">
    {% endif %}

    {% if photo.vote_score < -2 %}
        {% if not from_photos and is_first %}
            <img style="width:100%;max-width:400px;margin-bottom:0.3em;border:1px solid lightgrey" alt="no pic" src="{{ STATIC_URL }}img/broken_pic.png"></img>
        {% else %}
            <img src="{{ STATIC_URL }}img/broken_pic.png" alt="no pic" width="38px;"></img>
        {% endif %}
    {% elif photo.vote_score < -1 %}
        {% if not from_photos and is_first %}
            {% if photo.image_file %}
                <img style="filter:brightness(30%);-webkit-filter: brightness(0.3);width:100%;max-width:400px;margin-bottom:0.3em;border:1px solid lightgrey" alt="no pic" src="{{ photo.image_file.url }}"></img>
            {% else %}
                <img style="width:100%;max-width:400px;margin-bottom:0.3em;border:1px solid lightgrey" alt="no pic" src="{{ STATIC_URL }}img/broken_pic.png"></img>
            {% endif %}
        {% else %}    
            {% if photo.image_file %}
                <img src="{{ photo.image_file.url|thumbnail }}" alt="no pic" style="filter:brightness(50%);border:1px solid blue;width:auto;"></img>
            {% else %}
                <img src="{{ STATIC_URL }}img/broken_pic.png" alt="no pic" width="38px;"></img>
            {% endif %}
        {% endif %}
    {% else %}
        {% if not from_photos and is_first %}
            {% if photo.image_file %}
                <img style="width:100%;max-width:400px;margin-bottom:0.3em;border:1px solid lightgrey" alt="no pic" src="{{ photo.image_file.url }}"></img>
            {% else %}
                <img style="width:100%;max-width:400px;margin-bottom:0.3em;border:1px solid lightgrey" alt="no pic" src="{{ STATIC_URL }}img/broken_pic.png"></img>
            {% endif %}
        {% else %}
        	{% if photo.image_file %}
            	<img src="{{ photo.image_file.url|thumbnail }}" alt="no pic" style="border:1px solid blue;width:auto;"></img>
            {% else %}
            	<img src="{{ STATIC_URL }}img/broken_pic.png" alt="no pic" width="35px;"></img>
            {% endif %}
        {% endif %}
    {% endif %}</a>
    
    {% if from_photos or not is_first %}
    <span style="color:#404040;font-size:90%;">{{ photo.caption|truncatechars:30 }}</span>
    {% else %}
    <br><span style="color:#404040;font-size:100%;"><b>{{ photo.caption }}</b></span>
    {% endif %}

    {% if from_photos or not is_first %}
    <br><span style="color:#a6a6a6;font-size:80%;">photo by <a href="{% url 'profile' photo.owner.username %}">{{ photo.owner }}</a></span><br>
    {% else %}
    <span style="color:#a6a6a6;font-size:80%;">, photo by <a href="{% url 'profile' photo.owner.username %}">{{ photo.owner }}</a></span><br>
    {% endif %}

<br><b style="font-size:98%;text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);color:#ff8000;">Tabsra likho:</b>
    <form action="{% url 'comment' %}" method="POST">
	{% csrf_token %}
    <input type="hidden" id="id_link" name="from_photos" class="hidden_id" value="{{ from_photos }}">
    {{ form.errors }}
    {{ form.text }}
    <br>
    <input class="button" style="border-color:#ff8000;background-color:#ff9933;color:white;text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);border-radius:4px;margin-bottom:0.7em;" type="submit" value="OK" id="id_submit">
    </form>
{% if count > 0 %}
    {% if count > 25 %}
      <span style="font-size:90%;text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);color:#ff8000;">Pichley <b>25</b> tabsrey:</span><br>
      {% elif count == 1 %}
      <span style="font-size:90%;text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);color:#ff8000;"><b>1</b> tabsra:</span><br>
      {% else %}
      <span style="font-size:90%;text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);color:#ff8000;"><b>{{ count }}</b> tabsrey:</span><br>
      {% endif %}
    <table>
    {% for comment in comments %}
    
    <tr><td>
    {% if forloop.counter != 1 %}
    <hr size=1 COLOR="ORANGE">
    {% endif %}
    {% if comment.abuse %}
        {% if authenticated and viewed_at %}
        {% if comment.submitted_on > viewed_at and comment.submitted_by != user %}
            <b style="color:orange;font-size:80%">(new)</b>&nbsp;
        {% endif %}
        {% endif %}
        <a href="{% url 'profile' comment.submitted_by.username %}#section0" style="font-size:90%;">
        {% if comment.submitted_by.userprofile.avatar %}
            <img src="{{ comment.submitted_by.userprofile.avatar.url|thumbnail }}" alt="no pic"></img>
        {% else %}
            <img src="{{ STATIC_URL }}img/default-avatar-min.jpg" alt="no pic"></img>
        {% endif %}
    {{ comment.submitted_by.username }}</a>
        <span style="font-size:70%;">
            {% if comment.submitted_by.userprofile.score %}
                {% if comment.submitted_by.userprofile.score < 0 %}
                    <span style="color:#18A018;">(1)</span>
                {% else %}
                    <span style="color:#18A018;">({{ comment.submitted_by.userprofile.score }})</span>
                {% endif %}
            {% endif %}
        </span>

        {% for person in verified %}
            {% if person == comment.submitted_by.username %}
            <span style="color:deeppink;"><b>*</b></span>
            {% endif %}
        {% endfor %}
        
        <span style="color:grey;font-size:90%;">ke tabsrey ko <b>{{ photo.owner }}</b> ne hide kr dia</span>

    {% else %}

    {% if authenticated and viewed_at %}
        {% if comment.submitted_on > viewed_at and comment.submitted_by != user %}
        <b style="color:orange;font-size:80%">(new)</b>&nbsp;
        {% endif %}
    {% endif %}
    <a href="{% url 'profile' comment.submitted_by.username %}#section0" style="font-size:90%;">
    	{% if comment.submitted_by.userprofile.avatar %}
        	<img src="{{ comment.submitted_by.userprofile.avatar.url|thumbnail }}" alt="no pic"></img>
        {% else %}
        	<img src="{{ STATIC_URL }}img/default-avatar-min.jpg" alt="no pic"></img>
        {% endif %}
    {{ comment.submitted_by.username }}</a>
        <span style="font-size:70%;">
            {% if comment.submitted_by.userprofile.score %}
                {% if comment.submitted_by.userprofile.score < 0 %}
                    <span style="color:#18A018;">(1)</span>
                {% else %}
                    <span style="color:#18A018;">({{ comment.submitted_by.userprofile.score }})</span>
                {% endif %}
            {% endif %}
        </span>

    	{% for person in verified %}
            {% if person == comment.submitted_by.username %}
            <span style="color:deeppink;"><b>*</b></span>
            {% endif %}
        {% endfor %}
    :&nbsp;<bdi style="color:#404040;">{% emoticons %}{{ comment.text }}{% endemoticons %}</bdi><span style="font-size:73%;color:gray;"><bdi>, {{ comment.submitted_on|naturaltime }}</bdi>
    	{% if comment.device == '1' %}
        &nbsp;<img src="{{ STATIC_URL }}img/featurephone.png" alt="no pic"></img>
        {% elif comment.device == '2' %}
        &nbsp;<img src="{{ STATIC_URL }}img/smartphone.png" alt="no pic"></img>
        {% elif comment.device == '4' %}
        &nbsp;<img src="{{ STATIC_URL }}img/tablet.png" alt="no pic"></img>
        {% elif comment.device == '5' %}
        &nbsp;<img src="{{ STATIC_URL }}img/other.png" alt="no pic"></img>
        {% elif comment.device == '3' %}
        &nbsp;<img src="{{ STATIC_URL }}img/laptop.png" alt="no pic"></img>
        {% else %}
        {% endif %}
    </span>
    {% if user == photo.owner %}
    &nbsp;
    {% if photostream_pk and from_photos %}
    <a href="{% url 'reportcomment_pk' pk=comment.pk num=photo.pk photostream=photostream_pk from_photos=from_photos %}">
    {% elif photostream_pk %}
    <a href="{% url 'reportcomment_pk' pk=comment.pk num=photo.pk photostream=photostream_pk %}">
    {% else %}
    <a href="{% url 'reportcomment_pk' pk=comment.pk num=photo.pk %}">
    {% endif %}
    <button style="font-weight:bold;color:white;background-color:#bfbfbf;border-color:#a6a6a6;width:3.5em;white-space:nowrap;border-radius: 3px;text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);text-align: center;font-size:65%;">hide</button></a>
    {% endif %}
    <br>
    {% endif %}
    </td></tr>
    {% endfor %}
    </table>
{% endif %}
<p style="margin-top:0.5em;"></p>
<hr size=1 COLOR="ORANGE">
<p style="margin-top:-0.9em;"></p>
<hr size=1 COLOR="ORANGE">

<span style="font-size:80%;color:dimgrey;"><b>Sticker banane ke liye uske agey likhe harf type kro:<br></b><span style="font-size:95%;">(poori list <a href="{% url 'emoticons_help' %}"><u>ye hai</u></a>)</span></span>

{% emoticons_index as emoticons_list %}

{% for emoticons in emoticons_list %}
{% if forloop.counter in random %}
<p>{{ emoticons.0|emoticons }}    {{ emoticons.0 }}</p>
{% endif %}
{% endfor %}

{% else %}
<h2 style="color:#404040;text-shadow: 0 0 0.3px rgba(0,0,0,0.3);">Ye is terah nahi chalta!</h2>
{% endif %}
</div>
{% endblock %}
